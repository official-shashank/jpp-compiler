<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #editorWrapper {
      position: relative;
      height: 70vh; /* Editor height */
    }
    #codeEditor {
      white-space: pre-wrap;
      word-wrap: break-word;
      outline: none;
      font-family: monospace;
      caret-color: white;
      color: white;
      line-height: 1.5;
      height: 100%;
      overflow-y: auto;
      padding: 1rem;
      background: #1e293b;
      border-radius: 8px;
    }
    #suggestionBox {
      position: absolute;
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 4px;
      padding: 4px 0;
      z-index: 10;
      font-family: monospace;
      color: white;
      display: none;
      max-width: 300px;
    }
    .suggestion-item {
      padding: 4px 8px;
      cursor: pointer;
    }
    .suggestion-item:hover {
      background-color: #374151;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans min-h-screen">

  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="p-4 bg-gray-800 flex justify-between items-center">
      <h1 class="text-lg font-bold text-white">Code Playground</h1>
      <select id="languageSelector" class="bg-gray-700 text-white p-2 rounded">
        <option value="javascript">JavaScript</option>
        <option value="python">Python</option>
        <option value="html">HTML</option>
        <option value="css">CSS</option>
      </select>
    </header>

    <!-- Main Content -->
    <div class="flex-1 p-4 flex flex-col md:flex-row gap-4">
      <!-- Editor -->
      <div id="editorWrapper" class="flex-1 bg-gray-800 relative rounded">
        <div 
          id="codeEditor" 
          class="w-full h-full bg-transparent overflow-auto resize-none" 
          contenteditable="true"></div>
        <div id="suggestionBox"></div>
      </div>

      <!-- Output -->
      <div class="w-full md:w-1/3 p-4 bg-gray-800 flex flex-col">
        <button 
          id="runCode" 
          class="bg-blue-600 text-white py-2 px-4 mb-4 rounded hover:bg-blue-700">
          Run Code
        </button>
        <div id="output" class="bg-gray-900 text-white p-4 rounded h-full overflow-auto">
          Output will appear here.
        </div>
      </div>
    </div>
  </div>

  <script>
    const editor = document.getElementById('codeEditor');
    const languageSelector = document.getElementById('languageSelector');
    const suggestionBox = document.getElementById('suggestionBox');
    const runCode = document.getElementById('runCode');
    const output = document.getElementById('output');

    const languageDefinitions = {
      javascript: ['function', 'return', 'const', 'let', 'var', 'if', 'else', 'for', 'while', 'console.log', 'class'],
      python: ['def', 'return', 'if', 'else', 'elif', 'for', 'while', 'import', 'print', 'class'],
      html: ['<div>', '<span>', '<p>', '<a>', '<html>', '<body>', '<head>', '<script>', '<style>'],
      css: ['color', 'background', 'margin', 'padding', 'font-size', 'border', 'width', 'height'],
    };

    let currentLanguage = languageSelector.value;

    // Position the suggestion box
    const positionSuggestionBox = (box, range) => {
      const rect = range.getBoundingClientRect();
      box.style.top = `${rect.bottom + window.scrollY}px`;
      box.style.left = `${rect.left + window.scrollX}px`;
    };

    // Extract the current word under cursor
    const getCurrentWord = () => {
      const selection = window.getSelection();
      if (!selection.rangeCount) return '';
      const range = selection.getRangeAt(0);
      const text = range.startContainer.textContent || '';
      const cursorPosition = range.startOffset;
      const beforeCursor = text.slice(0, cursorPosition);
      const afterCursor = text.slice(cursorPosition);

      const wordStart = beforeCursor.lastIndexOf(' ') + 1;
      const wordEnd = afterCursor.indexOf(' ') === -1 ? afterCursor.length : afterCursor.indexOf(' ');
      return beforeCursor.slice(wordStart) + afterCursor.slice(0, wordEnd);
    };

    // Show suggestions
    const showSuggestions = () => {
      const word = getCurrentWord().trim();
      if (!word) {
        suggestionBox.style.display = 'none';
        return;
      }

      const keywords = languageDefinitions[currentLanguage] || [];
      const suggestions = keywords.filter((kw) => kw.startsWith(word));
      if (suggestions.length > 0) {
        suggestionBox.innerHTML = suggestions
          .map((s) => `<div class="suggestion-item">${s}</div>`)
          .join('');
        suggestionBox.style.display = 'block';

        // Position suggestion box
        const range = window.getSelection().getRangeAt(0);
        positionSuggestionBox(suggestionBox, range);
      } else {
        suggestionBox.style.display = 'none';
      }
    };

    // Handle input for suggestions
    editor.addEventListener('input', showSuggestions);

    // Apply suggestion on click
    suggestionBox.addEventListener('click', (e) => {
      if (e.target.classList.contains('suggestion-item')) {
        const suggestion = e.target.textContent;
        const selection = window.getSelection();
        const range = selection.getRangeAt(0);

        // Replace the current word with the suggestion
        const textNode = range.startContainer;
        const cursorPosition = range.startOffset;
        const text = textNode.textContent;

        const wordStart = text.lastIndexOf(' ', cursorPosition - 1) + 1;
        const wordEnd = text.indexOf(' ', cursorPosition) === -1 ? text.length : text.indexOf(' ', cursorPosition);
        const updatedText =
          text.slice(0, wordStart) + suggestion + text.slice(wordEnd);

        textNode.textContent = updatedText;

        suggestionBox.style.display = 'none';

        // Restore cursor position
        const newCursorPosition = wordStart + suggestion.length;
        const newRange = document.createRange();
        newRange.setStart(textNode, newCursorPosition);
        newRange.collapse(true);
        selection.removeAllRanges();
        selection.addRange(newRange);
      }
    });

    // Run the code
    runCode.addEventListener('click', () => {
      const code = editor.innerText.trim();
      if (currentLanguage === 'javascript') {
        try {
          const result = eval(code);
          output.textContent = result;
        } catch (err) {
          output.textContent = `Error: ${err.message}`;
        }
      } else {
        output.textContent = `Execution not supported for ${currentLanguage} yet!`;
      }
    });

    // Change language
    languageSelector.addEventListener('change', (e) => {
      currentLanguage = e.target.value;
      editor.innerText = '';
      output.textContent = '';
    });

    // Hide suggestion box on clicking outside
    document.body.addEventListener('click', () => {
      suggestionBox.style.display = 'none';
    });
  </script>
</body>
</html>
